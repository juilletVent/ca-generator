[ ca ]
# Intermediate Certificate Authority Configuration
default_ca = CA_default

[ CA_default ]
# Directory and file locations
dir = ./
certs = $dir/cert
new_certs_dir = $dir/signed_certs
database = $dir/index.txt
serial = $dir/serial
RANDFILE = $dir/private/.rand

# Intermediate CA certificate and private key
private_key = $dir/private/intermediate_ca.key.pem
certificate = $dir/cert/intermediate_ca.cert.pem

# Certificate Revocation List settings (optional)
# crlnumber = $dir/crlnumber
# crl = $dir/crl/intermediate_ca.crl.pem
# crl_extensions = crl_ext
# default_crl_days = 30

# Hashing and signing algorithm
default_md = sha256

# Certificate display options
name_opt = ca_default
cert_opt = ca_default

# Default certificate validity
default_days = 375
preserve = no
policy = policy_loose

# Copy extensions from CSR (important for SAN)
copy_extensions = copy

# Loose policy for signing end-entity certificates
[ policy_loose ]
countryName = optional
stateOrProvinceName = optional
localityName = optional
organizationName = optional
organizationalUnitName = optional
commonName = supplied
emailAddress = optional

[ req ]
# Certificate request settings
default_bits = 2048
distinguished_name = req_distinguished_name
string_mask = utf8only
default_md = sha256

# Distinguished Name field descriptions and defaults
[ req_distinguished_name ]
countryName = Country Name (2 letter code)
countryName_default = CN
stateOrProvinceName = State or Province Name
stateOrProvinceName_default = Beijing
localityName = Locality Name
localityName_default = Beijing
0.organizationName = Organization Name
0.organizationName_default = Internal Certificate Authority
organizationalUnitName = Organizational Unit Name
organizationalUnitName_default = Certificate Authority Division
commonName = Common Name
commonName_default = Internal Intermediate CA
emailAddress = Email Address
emailAddress_default = ca-admin@internal.local

[ server_cert ]
# Server certificate extensions (for HTTPS/TLS servers)
# 注意：CA签发时会从CSR中复制扩展信息（包括SAN）
# 因此，站点证书的域名/IP配置应在 openssl_csr.conf 中修改
basicConstraints = CA:FALSE
nsCertType = server
nsComment = "Internal CA - Server Certificate"
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer:always
keyUsage = critical, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth, clientAuth
# CRL distribution points (optional, uncomment if needed)
# crlDistributionPoints = URI:
# Authority Information Access (optional, uncomment if needed)
# authorityInfoAccess = OCSP;URI:

[ client_cert ]
# Client certificate extensions (for client authentication)
basicConstraints = CA:FALSE
nsCertType = client, email
nsComment = "Internal CA - Client Certificate"
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer
keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage = clientAuth, emailProtection

# Certificate Revocation List extensions (optional)
[ crl_ext ]
authorityKeyIdentifier = keyid:always